**KD-Tree（K-Dimensional Tree，k 维树）**
 KD-Tree 是一种数据结构，用于在 **多维空间中存储点数据**，可以用来查找距离上最近的点。

1. KD-Tree的构建

   KD-Tree 在 2D 空间：
    1️⃣ 首先选择 x 轴（第 1 维）分割空间，中间值作为分割线
    2️⃣ 子区域再用 y 轴（第 2 维）分割
    3️⃣ 不断递归，直到每个叶子是一个点或小集合
    查询时：只访问可能包含最近邻的子树，大幅减少计算

   假设我们有如下几个点(1,4) (5,2) (7,9) (9,8) (12,6) 我们要找距离(6,6) 最近的点。

   那么我们首先得建立一个KD-Tree，按照建立步骤(记住我们分割选取轴的顺序，因为找临近点的时候也得按照这个顺序取查找)

   1. 选取x轴作为分割线，我们发现(7,9)这个点的x坐标处于中位数，于是数据集分成两部分( 1, 4 )  ( 5 , 2 ) 和 （ 9 , 8 ）（ 12 , 6 ）

    2. 继续分割，这次按照y轴做分割，再两个更小的集合上做分割，不妨分别以y=4和y=8做分割线(由于每个集合只有两个点，取谁都一样)

    3. 此时我们可以得到如下类似的树的结构（树的左侧表示以当前节点某个方向上的值做分割小于他的子树）：
       <img src="C:\Users\陈意权\Desktop\e81c76f41456fc60e8a597fa745fe4a.jpg" alt="e81c76f41456fc60e8a597fa745fe4a" style="zoom: 33%;" />

          图1

    4. 在二维平面内，我们可以这样看：
       <img src="C:\Users\陈意权\Desktop\bbc2f4dc7742f0a4ba909773c033fd1.jpg" alt="bbc2f4dc7742f0a4ba909773c033fd1" style="zoom:33%;" />

       ​			图2

       5.为了找到距离（6，6）最近的点的位置，我们就得沿着我们分割的顺序去看:

        1. 首先是 x= 7 , 6< 7 ,所以我们去 x = 7的左侧找 （1，4）和 (5 , 2 )

        2. 然后是按照 y = 4去判断 ,4 < 6 ，所以去y=4的右侧去找 (由于没有右侧，那就直接选择左侧，而节点 （5，2）是叶子节点（没有子节点的节点） 那就把它当备选) 

           为什么是备选节点呢？因为二维平面内,点与点的欧氏距离应当是  
           $$
           d = \sqrt{(x_1 - x_2)^2 + (y_1 - y_2)^2}
           $$

​		而我们每次去搜索的时候只能选取一个维度,另一个方向上没有比较，所以还需要验证下距离是否真的最小,如何验证呢？

​		由于我们暂时选了（5，2） 按照公式距离应当是 

```math
				
				d = \sqrt{(5 - 6)^2 + (2 - 6)^2} ≈4.123
				
```
​		然后我们以4.123为半径画圆，如果圆存在元素,说明还有距离更小的点，直观上这么看：
​			 

​				

​			

<img src="C:\Users\陈意权\Desktop\微信图片_20250624202257.jpg" alt="微信图片_20250624202257" style="zoom:33%;" />

​								图3

​			由图可知，确实存在点距离比4.123小，但是计算机它不知道啊(OS:不是哥们，你先让我按照啥破x=7,y=4的方向上找，然后你自己库库画个圆告诉我有距离更小的点？不儿？你是觉得我懂你呗？跳出屏幕瞅下你画的圆？啊，那我问你？)所以我们得想个法子找这些点：

   1. 首先最直接的就是直接遍历所有点求出距离 然后比较(仔细一想，我都直接遍历了，我还建个毛的树啊)

   2. 那就看看根据这个树我们能获取哪些信息（貌似只有大于某个具体轴的数据分布比如x=7,y=4 ) 不如看看能咋用 ，已知在座的各位都是9年义务教育的精英( 谁赞成谁反对)。

      1. 点到直线的距离是垂线段 

         2. 在二维平面里，圆和平面无非三种关系 相离 ，相切，还有相交，如图：

            ​	<img src="C:\Users\陈意权\Desktop\cfef6db63e7150b7bb9f5c67307af04.jpg" alt="cfef6db63e7150b7bb9f5c67307af04" style="zoom:33%;" />

            ​					图4

​	**分别以x = 4,5,6 分割的右侧平面内, 只有在x = 4的右侧的平面内(包括x = 4)才有可能存在点距离A要比B近吧。**

​	所以我们带入到图3中 ，由于4.123的 距离 是大于 我们的目标点(6,6) 距离y = 4的距离2的 ，所以我们要在 y=4上（包括4的范围内去比较），此时只有(1,4) ,代入 
$$
d = \sqrt{(1-6)^2+(4-6)^2} ≈ 5.385 >  4.123 
$$
所以备选节点(5,2) 暂时还是最短的，往上一层（还没完的原因是只是说明暂时这个以x = 7的左侧 (5,2) 是最近的点），也就是x = 7。

目标(6,6)距离x = 7只有1的距离 属于我们**图4**中的 **x = 4**的这种情况，所以我们得考虑**图3*x =7及其右侧**的数据，

1. 首先带入根节点(7,9)  -> x = 7的部分

$$
d = \sqrt{(7-6)^2+(9-6)^2} ≈ 3.16 < 4.123
$$

​		**此时最近点为(7,9) 最近距离为3.16**

2. 判断 x > 7的部分，我们发现此时的最短距离3.16 大于 目标点(6,6) 距离  y = 8 的距离(距离为2 ) ，所以我们继续在右侧判断。

   首先带入根节点(9,8) 
   $$
   d = \sqrt{(9-6)^2+(8-6)^2} ≈ 3.6 > 3.16 
   $$
   继续判断以y = 9 为分割的其他子数据集，由于上方没有，我们考虑下方只有一个的节点（12，6），计算后发现距离还是（7，9）最近，至此搜索完毕，返回(7,9) 。

   思考下 如果（12，6） 的右侧范围内还有数据，此时是否还需要考虑呢？如下图 答案是否定的(参考图4下的结论)：
   	<img src="C:\Users\陈意权\Desktop\607f382c6e5908ad0720710d7f559a4.jpg" alt="607f382c6e5908ad0720710d7f559a4" style="zoom:33%;" />

   (欢迎大家在评论区讨论和指正，本人只是一个初学者，轻喷)